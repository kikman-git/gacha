{"ast":null,"code":"var _jsxFileName = \"/home/kikman/JavaScript/Gacha/gacha/gacha/src/components/Gacha.js\";\nimport React, { Component } from 'react';\nimport '../styles/Gacha.css';\nimport { Redirect } from 'react-router-dom';\nimport axios from 'axios';\nimport gacha from '../resources/gacha_img.png';\nimport gacha_ball from '../resources/gacha_ball.png';\nimport gacha_btn from '../resources/gacha_btn.png';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction getRandomInt(max) {\n  return Math.floor(Math.random() * max);\n}\n\nasync function rewardGenerator(items) {\n  //   const items = await itemGenerator();\n  console.log(items);\n  let rewardList = [null, '10%', '100y', '200y', '500y', '1000y', '10000y'].concat(items); // Get random index number\n\n  let valueIndex = getRandomInt(rewardList.length);\n  console.log(rewardList);\n  return rewardList[valueIndex];\n} // Rewards: [null(lost),... coupons, objects(products from rakuten)]\n// if null/objects => /reward => display\n// if coupons => generate coupons + display\n// send request to generate new coupon\n\n\nasync function addPost(value) {\n  //   event.preventDefault();\n  const body = {\n    genre: 'GEN',\n    user: JSON.parse(window.sessionStorage.getItem('data'))['id'],\n    expire_date: '2021-10-10',\n    value: value,\n    status: true\n  };\n  const config = {\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: `Token ${JSON.parse(window.sessionStorage.getItem('data'))['token']}`\n    }\n  };\n\n  try {\n    const response = await axios.post('http://127.0.0.1:8000/coupons/create/', JSON.stringify(body), config);\n    console.log(response);\n  } catch (err) {\n    console.log(err);\n  }\n}\n\nclass Gacha extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      active: false,\n      couponActive: false,\n      items: []\n    };\n    this.AnimaHandler = this.AnimaHandler.bind(this);\n    this.CouponHandler = this.CouponHandler.bind(this);\n  }\n\n  componentDidMount() {\n    const applicationId = '1074305052326638295';\n    const apiEndpoint = `https://app.rakuten.co.jp/services/api/IchibaItem/Ranking/20170628?format=json&age=20&applicationId=${applicationId}`;\n    fetch(apiEndpoint).then(response => response.json()).then(data => this.setState({\n      items: data\n    }));\n  }\n\n  AnimaHandler() {\n    // console.log(JSON.stringify(CouponGenerator()));\n    const currentState = this.state.active;\n    this.setState({\n      active: !currentState\n    });\n  }\n\n  CouponHandler() {\n    // rewardList [null, ...7coupons, ...30products]\n    const reward = rewardGenerator(this.state.items); // if index != 0 which means got reward\n\n    if (reward) {\n      const currentState = this.state;\n      this.setState({\n        couponActive: !currentState.couponActive\n      }); // check if reward is a coupon or a product\n      // if it is a coupon\n\n      if (typeof reward === String) {\n        addPost(reward); // Post to backend server\n      }\n    }\n\n    sessionStorage.setItem('reward', reward);\n  }\n\n  render() {\n    if (this.state.couponActive) {\n      return /*#__PURE__*/_jsxDEV(Redirect, {\n        to: \"/Award\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 14\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"GachaContainer\",\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        src: gacha,\n        alt: \"gacha\",\n        className: \"Gacha\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n        src: gacha_btn,\n        alt: \"gacha_btn\",\n        className: this.state.active ? 'GachaBtn GachaBtn-rotate' : 'GachaBtn',\n        onClick: this.AnimaHandler\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n        src: gacha_ball,\n        alt: \"gacha_ball\",\n        className: this.state.active ? 'GachaBall GachaBall-anima' : 'GachaBall',\n        onClick: this.CouponHandler\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"playBtn\",\n        onClick: this.AnimaHandler,\n        children: [' ', \"Play\", ' ']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default Gacha;","map":{"version":3,"sources":["/home/kikman/JavaScript/Gacha/gacha/gacha/src/components/Gacha.js"],"names":["React","Component","Redirect","axios","gacha","gacha_ball","gacha_btn","getRandomInt","max","Math","floor","random","rewardGenerator","items","console","log","rewardList","concat","valueIndex","length","addPost","value","body","genre","user","JSON","parse","window","sessionStorage","getItem","expire_date","status","config","headers","Authorization","response","post","stringify","err","Gacha","constructor","props","state","active","couponActive","AnimaHandler","bind","CouponHandler","componentDidMount","applicationId","apiEndpoint","fetch","then","json","data","setState","currentState","reward","String","setItem","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport '../styles/Gacha.css';\nimport { Redirect } from 'react-router-dom';\nimport axios from 'axios';\nimport gacha from '../resources/gacha_img.png';\nimport gacha_ball from '../resources/gacha_ball.png';\nimport gacha_btn from '../resources/gacha_btn.png';\n\nfunction getRandomInt(max) {\n  return Math.floor(Math.random() * max);\n}\n\nasync function rewardGenerator(items) {\n  //   const items = await itemGenerator();\n  console.log(items);\n  let rewardList = [\n    null,\n    '10%',\n    '100y',\n    '200y',\n    '500y',\n    '1000y',\n    '10000y',\n  ].concat(items);\n\n  // Get random index number\n  let valueIndex = getRandomInt(rewardList.length);\n  console.log(rewardList);\n  return rewardList[valueIndex];\n}\n\n// Rewards: [null(lost),... coupons, objects(products from rakuten)]\n// if null/objects => /reward => display\n// if coupons => generate coupons + display\n\n// send request to generate new coupon\nasync function addPost(value) {\n  //   event.preventDefault();\n  const body = {\n    genre: 'GEN',\n    user: JSON.parse(window.sessionStorage.getItem('data'))['id'],\n    expire_date: '2021-10-10',\n    value: value,\n    status: true,\n  };\n\n  const config = {\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: `Token ${\n        JSON.parse(window.sessionStorage.getItem('data'))['token']\n      }`,\n    },\n  };\n\n  try {\n    const response = await axios.post(\n      'http://127.0.0.1:8000/coupons/create/',\n      JSON.stringify(body),\n      config\n    );\n    console.log(response);\n  } catch (err) {\n    console.log(err);\n  }\n}\n\nclass Gacha extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      active: false,\n      couponActive: false,\n      items: [],\n    };\n\n    this.AnimaHandler = this.AnimaHandler.bind(this);\n    this.CouponHandler = this.CouponHandler.bind(this);\n  }\n  componentDidMount() {\n    const applicationId = '1074305052326638295';\n    const apiEndpoint = `https://app.rakuten.co.jp/services/api/IchibaItem/Ranking/20170628?format=json&age=20&applicationId=${applicationId}`;\n    fetch(apiEndpoint)\n      .then((response) => response.json())\n      .then((data) => this.setState({ items: data }));\n  }\n\n  AnimaHandler() {\n    // console.log(JSON.stringify(CouponGenerator()));\n    const currentState = this.state.active;\n    this.setState({ active: !currentState });\n  }\n\n  CouponHandler() {\n    // rewardList [null, ...7coupons, ...30products]\n    const reward = rewardGenerator(this.state.items);\n\n    // if index != 0 which means got reward\n    if (reward) {\n      const currentState = this.state;\n      this.setState({ couponActive: !currentState.couponActive });\n\n      // check if reward is a coupon or a product\n      // if it is a coupon\n      if (typeof reward === String) {\n        addPost(reward); // Post to backend server\n      }\n    }\n    sessionStorage.setItem('reward', reward);\n  }\n\n  render() {\n    if (this.state.couponActive) {\n      return <Redirect to=\"/Award\" />;\n    }\n    return (\n      <div className=\"GachaContainer\">\n        <img src={gacha} alt=\"gacha\" className=\"Gacha\" />\n        <img\n          src={gacha_btn}\n          alt=\"gacha_btn\"\n          className={\n            this.state.active ? 'GachaBtn GachaBtn-rotate' : 'GachaBtn'\n          }\n          onClick={this.AnimaHandler}\n        />\n        <img\n          src={gacha_ball}\n          alt=\"gacha_ball\"\n          className={\n            this.state.active ? 'GachaBall GachaBall-anima' : 'GachaBall'\n          }\n          onClick={this.CouponHandler}\n        />\n        <button className=\"playBtn\" onClick={this.AnimaHandler}>\n          {' '}\n          Play{' '}\n        </button>\n      </div>\n    );\n  }\n}\n\nexport default Gacha;\n"]},"metadata":{},"sourceType":"module"}